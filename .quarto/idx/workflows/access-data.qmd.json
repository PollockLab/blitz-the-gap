{"title":"Accessing the STAC Catalogue","markdown":{"yaml":{"title":"Accessing the STAC Catalogue","toc":true,"number-sections":true,"number-depth":1,"image":"images/stac.png"},"headingText":"What is a STAC Catalog?","containsRefs":false,"markdown":"\n\n\nFrom Bon in a Box's \"Working with STAC\" documentation, which you can see [here](https://geo-bon.github.io/bon-in-a-box-pipeline-engine/working_with_stac.html \"BiaB - Working with STAC\"):\n\n> STAC stands for SpatioTemporal Asset Catalog. It is a common language to describe geospatial information, so it can be more easily worked with, indexed, and discovered. Spatial information is stored in a geoJSON format, which can be easily adapted to different domains. The goal of STAC is to enable a global index of all imagery derived data products with an easily implementable standard for organization to expose their data in a persistent and reliable way. STAC objects are hosted in geoJSON format as HTML pages.\n\n# Biodiversité Québec's STAC Catalog\n\nBiodiversité Québec hosts many layers for biodiversity maps and models for Canada and Québec. Most of the layers we will use for challenges will be from this STAC Catalog.\n\nYou can view the layers at the following link:\n\n[![](https://img.shields.io/static/v1?style=for-the-badge&label=View&message=STAC-Catalog&color=e99002)](https://io.biodiversite-quebec.ca/viewer/inat_canada_heatmaps/inat-canada-heatmapPlantae)\n\nOptionally, you can also browse the [GEO BON STAC Catalog](https://stac.geobon.org/viewer/chelsa-clim/bio1) for global layers and access them using the documentation [here](https://geo-bon.github.io/bon-in-a-box-pipeline-engine/working_with_stac.html \"BiaB - Working with STAC\").\n\n## iNaturalist density maps\n\nA series of density maps of iNaturalist observations is hosted on the Biodiversité Québec STAC. This means you can access density maps and work with them as a proxy, or download it locally to use as the basis for a Blitz the Gap challenge. There are two resolutions available for each taxonomic group: 100m, and 1km.\n\nFirst, load the R packages you will need to use to access the density map layers:\n\n```{r, results='hide', message = FALSE}\nlibrary(gdalcubes)\nlibrary(rstac)\nlibrary(knitr)\nlibrary(stars)\nlibrary(terra)\nlibrary(ggplot2)\nlibrary(mapview)\n```\n\nSet up the connection to the STAC catalog:\n\n```{r, results='hide'}\n# set up\nstac_obj <- stac(\"https://io.biodiversite-quebec.ca/stac/\")\n\n# get iNaturalist heatmaps for Canada\nit_obj <- stac_obj |>\n  stac_search(collections = \"inat_canada_heatmaps\") |>\n  post_request() |> items_fetch()\nit_obj\n```\n\nGet a table showing which layers are available in the catalog:\n\n```{r}\n# See layers in the object\ndf <- data.frame(description=character())\nfor (f in it_obj[['features']]){\n  df <- rbind(df,data.frame(description=f$properties$description)) \n}\ndf$feature_number = 1:nrow(df)\n```\n\n```{r, echo = FALSE}\nkable(df) |>\n  # these next two lines are just so the table is scrollable + prettier on the html page\n  # you can ignore it if you run this locally !\n  kableExtra::kable_material() |>\n  kableExtra::scroll_box(height = \"400px\") |>\n  kableExtra::kable_styling(full_width = TRUE)\n```\n\n```{r, eval = FALSE}\ndf\n```\n\nLet's access one of the layers to map it, as an example. We'll map the density of iNaturalist observations across all taxa by selecting one of the features we listed in the table above.\n\nHow do we select one of the layers in the STAC Catalog? You can index them by checking the feature_number column above. \n\nHere, we want \"Density of observations in iNaturalist Canada for species of taxonomic group All at 1km resolution\", which is the 25th layer:\n\n```{r}\n# 37 is the number to change if you want another layer from the STAC\ninat <- read_stars(paste0('/vsicurl/', it_obj[['features']][[25]]$assets[[1]]$href), \n                   proxy = TRUE) # using it as a proxy (not a local download,\n                                 # to save time and space!)\n```\n\nNow, let's map it!\n\n```{r, echo = FALSE, results='hide'}\n# read the Canada polygon\ncanada = sf::read_sf(\"~/McGill University/Laura's Lab_Group - BioBlitz/data/raw/base-layers/canada-polygon/canada.outline.shp\")\n```\n\n```{r, echo = FALSE, results='hide'}\n# read the Canada polygon\ncanada = sf::read_sf(\"~/McGill University/Laura's Lab_Group - BioBlitz/data/raw/base-layers/canada-polygon/canada.outline.shp\")\n```\n\nFirst, load a polygon of Canada that you can download from the `data/raw` folder on the Sharepoint (or the `00_rawdata` folder on the [GitHub repository](https://github.com/CIEE-Living-Data-Project/blitz-the-gap)). _Make sure to update the file path to match the folder in which you placed the file when you downloaded it!_\n\n```{r, eval = FALSE}\n# read the Canada polygon\ncanada = sf::read_sf(\"data/raw/base-layers/canada-polygon/canada.outline.shp\")\n```\n\nPrepare the data for plotting, and use ggplot2 to map it!\n\n```{r, cache = TRUE}\n# crop the raster to canada (to cut off the ocean, USA, etc.)\ninat = sf::st_crop(inat, canada)\n\n# (optional) transform data for easier plotting\n# this will square root each raster cell's value. this could also be log10, etc.\ninat_sqrt = inat |> sqrt()\n\n# map!\nggplot() +\n  geom_stars(data = inat_sqrt, \n             # plotting at a coarser resolution to make this faster\n             downsample = 10, \n             na.action = na.omit) +\n  scale_fill_viridis_c(option = \"turbo\", \n                       end = .5,\n                       na.value = \"transparent\") +\n  theme_void() +\n  theme(legend.position = \"top\") +\n  labs(fill = \"Density\") +\n  coord_equal() \n```\n\nTo make an interactive map that we can zoom into, we can use the package `mapview`:\n\nFirst, let's some mapview options to apply to all the maps we will make here:\n\n```{r}\nmapviewOptions(basemaps = c(\"OpenStreetMap\"),\n               na.color = \"transparent\")\n```\n\nNow, here's the map!\n\n```{r}\npal = viridis::turbo(5)\nmapview(inat_sqrt, \n        col.regions = pal, # assign color palette\n        layer.name = \"Density (sqrt)\") \n```\n","srcMarkdownNoYaml":"\n\n# What is a STAC Catalog?\n\nFrom Bon in a Box's \"Working with STAC\" documentation, which you can see [here](https://geo-bon.github.io/bon-in-a-box-pipeline-engine/working_with_stac.html \"BiaB - Working with STAC\"):\n\n> STAC stands for SpatioTemporal Asset Catalog. It is a common language to describe geospatial information, so it can be more easily worked with, indexed, and discovered. Spatial information is stored in a geoJSON format, which can be easily adapted to different domains. The goal of STAC is to enable a global index of all imagery derived data products with an easily implementable standard for organization to expose their data in a persistent and reliable way. STAC objects are hosted in geoJSON format as HTML pages.\n\n# Biodiversité Québec's STAC Catalog\n\nBiodiversité Québec hosts many layers for biodiversity maps and models for Canada and Québec. Most of the layers we will use for challenges will be from this STAC Catalog.\n\nYou can view the layers at the following link:\n\n[![](https://img.shields.io/static/v1?style=for-the-badge&label=View&message=STAC-Catalog&color=e99002)](https://io.biodiversite-quebec.ca/viewer/inat_canada_heatmaps/inat-canada-heatmapPlantae)\n\nOptionally, you can also browse the [GEO BON STAC Catalog](https://stac.geobon.org/viewer/chelsa-clim/bio1) for global layers and access them using the documentation [here](https://geo-bon.github.io/bon-in-a-box-pipeline-engine/working_with_stac.html \"BiaB - Working with STAC\").\n\n## iNaturalist density maps\n\nA series of density maps of iNaturalist observations is hosted on the Biodiversité Québec STAC. This means you can access density maps and work with them as a proxy, or download it locally to use as the basis for a Blitz the Gap challenge. There are two resolutions available for each taxonomic group: 100m, and 1km.\n\nFirst, load the R packages you will need to use to access the density map layers:\n\n```{r, results='hide', message = FALSE}\nlibrary(gdalcubes)\nlibrary(rstac)\nlibrary(knitr)\nlibrary(stars)\nlibrary(terra)\nlibrary(ggplot2)\nlibrary(mapview)\n```\n\nSet up the connection to the STAC catalog:\n\n```{r, results='hide'}\n# set up\nstac_obj <- stac(\"https://io.biodiversite-quebec.ca/stac/\")\n\n# get iNaturalist heatmaps for Canada\nit_obj <- stac_obj |>\n  stac_search(collections = \"inat_canada_heatmaps\") |>\n  post_request() |> items_fetch()\nit_obj\n```\n\nGet a table showing which layers are available in the catalog:\n\n```{r}\n# See layers in the object\ndf <- data.frame(description=character())\nfor (f in it_obj[['features']]){\n  df <- rbind(df,data.frame(description=f$properties$description)) \n}\ndf$feature_number = 1:nrow(df)\n```\n\n```{r, echo = FALSE}\nkable(df) |>\n  # these next two lines are just so the table is scrollable + prettier on the html page\n  # you can ignore it if you run this locally !\n  kableExtra::kable_material() |>\n  kableExtra::scroll_box(height = \"400px\") |>\n  kableExtra::kable_styling(full_width = TRUE)\n```\n\n```{r, eval = FALSE}\ndf\n```\n\nLet's access one of the layers to map it, as an example. We'll map the density of iNaturalist observations across all taxa by selecting one of the features we listed in the table above.\n\nHow do we select one of the layers in the STAC Catalog? You can index them by checking the feature_number column above. \n\nHere, we want \"Density of observations in iNaturalist Canada for species of taxonomic group All at 1km resolution\", which is the 25th layer:\n\n```{r}\n# 37 is the number to change if you want another layer from the STAC\ninat <- read_stars(paste0('/vsicurl/', it_obj[['features']][[25]]$assets[[1]]$href), \n                   proxy = TRUE) # using it as a proxy (not a local download,\n                                 # to save time and space!)\n```\n\nNow, let's map it!\n\n```{r, echo = FALSE, results='hide'}\n# read the Canada polygon\ncanada = sf::read_sf(\"~/McGill University/Laura's Lab_Group - BioBlitz/data/raw/base-layers/canada-polygon/canada.outline.shp\")\n```\n\n```{r, echo = FALSE, results='hide'}\n# read the Canada polygon\ncanada = sf::read_sf(\"~/McGill University/Laura's Lab_Group - BioBlitz/data/raw/base-layers/canada-polygon/canada.outline.shp\")\n```\n\nFirst, load a polygon of Canada that you can download from the `data/raw` folder on the Sharepoint (or the `00_rawdata` folder on the [GitHub repository](https://github.com/CIEE-Living-Data-Project/blitz-the-gap)). _Make sure to update the file path to match the folder in which you placed the file when you downloaded it!_\n\n```{r, eval = FALSE}\n# read the Canada polygon\ncanada = sf::read_sf(\"data/raw/base-layers/canada-polygon/canada.outline.shp\")\n```\n\nPrepare the data for plotting, and use ggplot2 to map it!\n\n```{r, cache = TRUE}\n# crop the raster to canada (to cut off the ocean, USA, etc.)\ninat = sf::st_crop(inat, canada)\n\n# (optional) transform data for easier plotting\n# this will square root each raster cell's value. this could also be log10, etc.\ninat_sqrt = inat |> sqrt()\n\n# map!\nggplot() +\n  geom_stars(data = inat_sqrt, \n             # plotting at a coarser resolution to make this faster\n             downsample = 10, \n             na.action = na.omit) +\n  scale_fill_viridis_c(option = \"turbo\", \n                       end = .5,\n                       na.value = \"transparent\") +\n  theme_void() +\n  theme(legend.position = \"top\") +\n  labs(fill = \"Density\") +\n  coord_equal() \n```\n\nTo make an interactive map that we can zoom into, we can use the package `mapview`:\n\nFirst, let's some mapview options to apply to all the maps we will make here:\n\n```{r}\nmapviewOptions(basemaps = c(\"OpenStreetMap\"),\n               na.color = \"transparent\")\n```\n\nNow, here's the map!\n\n```{r}\npal = viridis::turbo(5)\nmapview(inat_sqrt, \n        col.regions = pal, # assign color palette\n        layer.name = \"Density (sqrt)\") \n```\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","embed-resources":true,"toc":true,"number-sections":true,"output-file":"access-data.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.6.41","theme":["yeti","../custom.scss"],"smooth-scroll":true,"fontsize":"12pt","grid":{"margin-width":"0px"},"title":"Accessing the STAC Catalogue","number-depth":1,"image":"images/stac.png"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}